@page "/cart"
@inherits BasePage

<AuthorizeView>
    <NotAuthorized>
        <RedirectToLogin />
    </NotAuthorized>
    <Authorized>
    <div class="mainContent">
            <MudText Typo="Typo.h4">My cart</MudText>
            <ConditionComponent Condition="cartItems.Any()">
                <NotMatch>
                    The cart is empty
                </NotMatch>
            </ConditionComponent>
            @foreach (var cartItem in cartItems)
            {
                <div class="cartItem">
                    <div style="display:flex">
                        <div style="background-image: url(@cartItem.Item.CoverPictureUri);" class="coverPicture" />
                        <p class="m-2 h6">@cartItem.Item.Name</p>
                    </div>
                    <div style="display:flex; flex-direction:column; padding:0.5rem;">
                        <p class="h6 text-end">@cartItem.Item.Price €</p>
                        <div style="display:flex;">
                            <MudNumericField @bind-Value="cartItem.Amount" Label="Amount" Variant="Variant.Text" Min="1" Style="width:2.5rem;"/>
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="async () => await DeleteCartItemAsync(cartItem, CancellationToken)"> delete</MudIconButton>
                        </div>
                    </div>
                </div>
            }
        </div>
        <ConditionComponent Condition="cartItems.Any()">
            <Match>
                <div class="toPaymentContainer">
                    <div style="display:flex; flex-direction:row; justify-content:space-between; padding:0.3rem;">
                        Total
                        <div> @GetTotal() €</div>
                    </div>
                    <MudButton ButtonType="ButtonType.Button" Variant="Variant.Text" Style="background-color:var(--lightGreen); width:90%;"> To payment</MudButton>
                </div>
            </Match>
        </ConditionComponent>
    </Authorized>
</AuthorizeView>
